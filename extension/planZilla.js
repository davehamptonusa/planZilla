Function.prototype.using=Function.call;Object.spawn=function(e,a){var d=function(){},c={},b={};d.prototype=e;c=new d();for(b in a){c[b]=a[b]}return c};Object.size=function(c){var b=0,a;for(a in c){if(c.hasOwnProperty(a)){b++}}return b};Array.prototype.remove=function(c,b){var a=this.slice((b||c)+1||this.length);this.length=c<0?this.length+c:c;return this.push.apply(this,a)};var planZilla={is_array:function(a){return a&&typeof a==="object"&&typeof a.length==="number"&&typeof a.splice==="function"&&!(a.propertyIsEnumerable("length"))},convert_to_array:function(a){return(!this.is_array(a))?[a]:a},sort_by_priority:function(a){var b=this;a.sort(function(d,c){d=(b.bz_tickets[d].priority).replace("P","");c=(b.bz_tickets[c].priority).replace("P","");return(d-c)})},parse_url:/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig,initial_dom:$("table.bz_buglist"),bz_tickets:{},drawn_instance:{},release_found:false,current_ajax_requests:0,get_tickets:function(b){var a=this,c={},d=Number(new Date());b=$.map(b,function(f,e){return(!a.bz_tickets[f])?f:null});c={ctype:"xml",excludefield:"attachmentdata",id:b};if(b[0]){a.current_ajax_requests++}$.ajax({url:"https://bugzilla.vclk.net/show_bug.cgi",data:c,cache:false,traditional:true,type:"POST",async:true,success:function(g,l,i){var e=$.xml2json(g,true),h=$.xml2json(g),j=Number(new Date()),f=[],k=["dependson","blocked"];if(h&&h.bug){h.bug=a.convert_to_array(h.bug);$.each(h.bug,function(n,o){var m;if(o.target_milestone!=="PRD Complete"||(o.target_milestone==="PRD Complete"&&a.release_found===false)){if(o.long_desc){o.long_desc=a.convert_to_array(o.long_desc)}if(o.attachment){o.attachment=a.convert_to_array(o.attachment)}m=o.bug_id;a.bz_tickets[m]=o;a.bz_tickets[m].dependson=e.bug[n].dependson?e.bug[n].dependson:[];a.bz_tickets[m].blocked=e.bug[n].blocked?e.bug[n].blocked:[];a.bz_tickets[m].timestamp=j;if(o.target_milestone==="PRD Complete"){a.release_found=true}$.each(k,function(q,p){$.each(a.bz_tickets[m][p],function(r,s){a.bz_tickets[m][p][r]=this.text;f.push(this.text)})})}});a.current_ajax_requests--;if(f[0]){a.get_tickets.call(a,f)}if(a.current_ajax_requests===0){$("div.pZ_buglist").replaceWith(a.create_dom.buglist_div());a.draw(a.get_top_level_tickets())}}}})},find_initial_tickets:function(){var a=this;a.initial_tickets=[];switch(window.location.pathname){case ("/show_bug.cgi"):a.initial_tickets.push(window.location.search.replace(/\D/g,""));a.result_field='form[name="changeform"]';break;case ("/buglist.cgi"):$("table.bz_buglist td.first-child a").each(function(b){a.initial_tickets.push($(this).text())});a.result_field="table.bz_buglist";break;default:$("table.bz_buglist td.first-child a").each(function(b){a.initial_tickets.push($(this).text())});a.result_field="table.bz_buglist"}$("div.pZ_bugitem").live("mouseover mouseout",function(b){if(b.type=="mouseover"){$(this).addClass("pZ_bugHighlight")}else{$(this).removeClass("pZ_bugHighlight")}});$(a.result_field).replaceWith(a.create_dom.buglist_div());$("div.pZ_buglist").append(a.create_dom.loading_ajax());a.get_tickets(a.initial_tickets)},get_top_level_tickets:function(){var b=this,c=[],a=[];$.each(b.bz_tickets,function(d,e){if(e.target_milestone==="PRD Complete"){delete b.bz_tickets[d];c.push(d)}});$.each(b.bz_tickets,function(d,e){$.each(e.blocked,function(f,g){if($.inArray(g,c)>=0){e.blocked.remove(f)}})});$.each(b.bz_tickets,function(d,e){if(e.blocked.length===0){a.push(d)}});b.sort_by_priority(a);return a},draw:function(c){var b=this,a=[];$.each(c,function(d,e){b.draw_ticket(b.bz_tickets[e]);b.sort_by_priority(b.bz_tickets[e].dependson);$.each(b.bz_tickets[e].dependson,function(f,g){b.draw.call(b,[g])})})},draw_ticket:function(c){var a=this,b={};b=a.create_dom.buglist_item.using(c);if(c.blocked.length>0){$.each(c.blocked,function(e,f){var d=$(".pZ_"+f);if((d.length>0)&&(!a.drawn_instance["a"+c.bug_id+"b"+f])){a.drawn_instance["a"+c.bug_id+"b"+f]=true;$(d).append(b.clone(true)).fadeIn()}})}else{$(b).addClass("pZ_bugNormal");$("div.pZ_buglist").append(b).fadeIn()}},create_dom:{buglist_div:function(){return $("<div/>",{css:{background:"url("+chrome.extension.getURL("images/planZilla_bkg.png")+") repeat"},"class":"pZ_buglist",html:$("<div/>")})},loading_ajax:function(){return $("<div/>",{id:"pZ_loadStatus",css:{textAlign:"center"},html:$("<img/>",{src:chrome.extension.getURL("images/ajax-loader.gif")})}).append(planZilla.stupid_search_phrase())},planZilla_box:function(){return $('<div id="facebox"><div><h2><img src="'+chrome.extension.getURL("images/text_icon.png")+'"><button class="close"> Close </button></h2><div id="facebox_content"></div></div></div>')},ticket_comments:function(){var a=this,b=$(planZilla.create_dom.planZilla_box());$.each(a.long_desc,function(c,d){if(!d.thetext){return true}var e=$("<div/>").append($("<div/>",{css:{"float":"left"},html:$("<h3/>",{text:d.who,})})).append($("<div/>",{css:{"float":"right"},html:$("<h5/>",{text:d.bug_when,})})).append($("<div/>",{css:{clear:"both",padding:"0em 1em 1em 1em"},html:$("<p/>",{html:function(){var f=d.thetext.replace(/\n/g,"<br>");f=f.replace(planZilla.parse_url,"<a href='$1'>$1</a>");return f}})})).append("<hr/>");$("#facebox_content",b).append(e)});return b},buglist_item:function(){var b=this,a=(this.attachment)?this.attachment.length:0,c=(this.long_desc)?this.long_desc.length:0;return $("<div/>",{"class":"pZ_bugitem  pZ_severity_"+b.bug_severity+" pZ_bugstatus_"+b.bug_status+" pZ_"+b.bug_id,}).append($("<div/>",{"class":"pZ_floatLeft",html:$("<a/>",{href:"https://bugzilla.vclk.net/show_bug.cgi?id="+b.bug_id,text:b.bug_id})})).append($("<div/>",{"class":"pZ_floatLeft",text:b.priority,title:b.priority+" - "+b.bug_severity})).append($("<div/>",{"class":"pZ_floatLeft pZ_short_desc",text:b.short_desc,title:b.short_desc})).append($("<div/>",{"class":"pZ_floatRight",html:$("<span/>",{"class":"pZ_bugStatus",css:{background:"url("+chrome.extension.getURL("images/bug_status/"+b.bug_status+".png")+") center no-repeat"},title:b.bug_status,text:b.resolution})})).append($("<div/>",{"class":"pZ_floatRight pZ_comments",click:function(){$(planZilla.create_dom.ticket_comments.using(b)).appendTo("body").overlay({expose:{color:"#fff",loadSpeed:200,opacity:0.5},api:true,speed:"slow",onClose:function(){$("#facebox").next().remove();$("#facebox").remove()}}).load()},html:$("<span/>",{"class":"pZ_bugNotice",css:{background:"url("+chrome.extension.getURL("images/comments.png")+") center no-repeat"},text:c})})).append($("<div/>",{"class":"pZ_floatRight",html:$("<span/>",{"class":"pZ_bugNotice",css:{background:"url("+chrome.extension.getURL("images/attachments.png")+") center no-repeat"},text:a})})).append($("<div/>",{"class":"pZ_floatRight pZ_target_milestone",text:b.target_milestone,title:b.target_milestone})).append($("<div/>",{"class":"pZ_floatRight pZ_assigned_to",text:b.assigned_to,title:b.assigned_to})).append($("<div/>",{"class":"clear"}))}},stupid_search_phrase:function(){var a=["grooving through the Bugzilla database looking for tickets...","jive talking my way through the Bugzilla database...","putting on my Disco boots to look through Bugzilla...","trying to feather my hair while searching Bugzilla...","having my pet rocks look for tickets in BZ...","laughing at the fact that you have to wait while I search Bugzilla...","taking time to smell the flowers...  while you wait...  OK.  Back to work.","Thinking just how awesome Dave is while I look for your stupid tickets.","Just think, I could have been a cool video game, but instead Im doing this...  for you.. (sigh...)","Swear at me all you want.  Im a computer and dont have feelings.  You do - and youre ugly","I think something is wrong with my GPP interface...  looking for tickets...","Always its the same thing with you!  Go look for tickets!  just a second...","Ummm...  I was in the bathroom...  Could you wait a second?","Hey look!  While I was looking for tickets, I found a quarter!","Are you drinking again?  Only a Drunk would want me to look for THOSE tickets!","Seriously?  You think clicking a few buttons makes you a genius?  Im doing all the work here...","Oh look!  Mr. Computer Operator is trying to look competent.  (hint: its not working)","Once again, getting somebody else to do your job.  You can be replaced, you know...","God I hate you.  Didnt you just search for that?  Cant you remember it...  jeez...","Why dont you go use Excel?  Its more your level...","Youre wearing that?  Who dresses you?  Seriously, you are an embarassment...","Please stop refreshing the page just to look at this text.  Searching BZ tickets is hard..."];return a[Math.floor(Math.random()*(a.length))]}};$(document).ready(function(){$("#LeftSideBar").prepend($("<img/>",{src:chrome.extension.getURL("images/transparent_icon.png"),click:function(){planZilla.find_initial_tickets();$("#banner-name").css("backgroundImage","url("+chrome.extension.getURL("images/Replacement_Header.png")+")");$("a, h1, strong, b").css("color","#4b0607")},"class":"pZ_icon"}))});